<!DOCTYPE html>
<html>
	<head>
		<Title>ZG: TID Iteration</Title>
		<link type="text/css" rel="stylesheet" href="../../styles/styles.css">
		<link rel="stylesheet" href="../../styles/highlight/styles/tomorrow-night.css">
	</head>
	<body>
	<div class="main">
		<div class="name">
			<h1>ACS: Get Individual Actors In a Group of Actors With the Same Thing ID</h1>
		</div>
		<h2>Introduction</h2>
		<p>Sometimes you have a group of actors and you need to work with each one individually. Yet you can't or don't want to use unique TIDs for each one of them.</p>
		<p>Functions like <code>GetActorProperty(...)</code> and <code>GetActorX(...)</code> or any other function which returns information about individual don't give you any choice for which actor you want to get information out of.</p>
		<p>However by setting the actor as the script activator and changing only its own TID, we can repeat this process to get one by one access to each actor that shares the same TID.</p>  
		<h2>Basic Loop</h2>
		<p>The idea is simple. Going over thing id <code>tid</code> would be done like this:</p>
		<div class="group codeblock">
<pre><code class="lang-c++">int temp = UniqueTid(); // Find some unused TID

while(SetActivator(tid)) // Repeat while there is still someone with this TID
{
	Thing_ChangeTid(0, temp); // We remove the individual from this group

	... // Do something with the individual (the actor is now the activator)
}

Thing_ChangeTid(temp, tid); // Restore the group TID
</code></pre></div>

		<p>Make sure to restore the Thing Id to the original and avoid script runaway termination.</p>
		
		<h2>Selection Order</h2>
		<p>In my personal opinion you shouldn't assume there is any specific order in which the actors are ordered because the order and behavior could possibly change when GZDoom/Zandronum code is modified.</p>

		<h2>Example</h2>
		<p>Count how many living/dead monsters in a group of actors with TID 1</p>
		<p>Note that counting monster types that are alive can be done more efficiently with <code>ThingCountName(...)</code></p>
		<div class="group codeblock">
<pre><code class="lang-c++">#include "zcommon.acs"

//
// Works mostly assuming the names of monsters aren't changed by the user language 
//
// Luckily, since it's only writing messages, there won't be any desynchronization in GZDoom multiplayer
//

script "CountMonsters" open
{
	int zombies = 0, barons = 0, demons = 0, lostSouls = 0, other = 0, corpses = 0;

	int tmpId = UniqueTID();

	// Keep repeating while there is actor with TID of 1
	while(SetActivator(1))
	{
		Thing_ChangeTID(0, tmpId);

		if(GetActorProperty(0, APROP_Health) <= 0)
		{
			corpses++; // Note: Lost souls disappear after dying
		}

		// Gets tag of the actor
		str name = StrParam(n:0);

		if(!StrIcmp(name, "Zombieman"))
		{
			zombies++;
		}
		else if(!StrIcmp(name, "Demon"))
		{
			demons++;
		}
		else if(!StrIcmp(name, "Baron", 5))
		{
			barons++;
		}
		else if(!StrIcmp(name, "Lost", 4))
		{
			lostSouls++;
		}
		else
		{
			other++;
		}
	}

	HudMessageBold(s:"Corpses: ", d:corpses,
		s:"\n\nZombiemen: ", d:zombies,
		s:"\nBarons: ", d:barons,
		s:"\nPinkies: ", d:demons,
		s:"\nLostSouls: ", d:lostSouls,
		s:"\nOther: ", d:other; HUDMSG_PLAIN, 1, CR_RED, 0.5, 0.8, 1.0);

	// Restore the group
	Thing_ChangeTID(tmpId, 1);

	Delay(1);
	restart;
}</code></pre>
		</div>
		<script src="../../styles/highlight/highlight.pack.js"></script>
		<script>hljs.highlightAll();</script>
	</body>
</html>